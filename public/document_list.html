<!DOCTYPE html>
<html>
<head>
    <title>Document List - Medi Fusion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
        .container { max-width: 800px; margin-top: 50px; }
    </style>
</head>
<body>
    <div class="container">
        <h3 class="mb-4">Uploaded Documents for Appointment #<span id="appointment-id"></span></h3>
        <ul class="list-group" id="document-list">
            <!-- Documents will be listed here by JavaScript -->
        </ul>
         <div id="no-documents-msg" class="alert alert-info mt-3" style="display: none;">
            No documents have been uploaded for this appointment.
        </div>
        <a href="/doctor_dashboard.html" class="btn btn-secondary mt-4">Back to Dashboard</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const docList = document.getElementById('document-list');
            const appointmentIdSpan = document.getElementById('appointment-id');
            const noDocsMsg = document.getElementById('no-documents-msg');

            const urlParams = new URLSearchParams(window.location.search);
            const appointmentId = urlParams.get('appointment_id');

            if (!appointmentId) {
                alert('No appointment ID specified.');
                return;
            }
            appointmentIdSpan.textContent = appointmentId;

            try {
                const token = localStorage.getItem('doctorAuthToken');
                const response = await fetch(`/api/appointments/${appointmentId}/documents`, {
                     headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const documents = await response.json();
                    if(documents.length > 0) {
                        docList.innerHTML = '';
                        documents.forEach(doc => {
                            const li = document.createElement('li');
                            li.className = 'list-group-item d-flex justify-content-between align-items-center';
                            
                            // Extract filename from path
                            const filename = doc.document_path.split('/').pop();

                            li.innerHTML = `
                                ${filename}
                                <a href="/ocr_result.html?doc_id=${doc.id}" class="btn btn-outline-primary btn-sm">Process with OCR</a>
                            `;
                            docList.appendChild(li);
                        });
                    } else {
                        noDocsMsg.style.display = 'block';
                    }
                } else {
                     noDocsMsg.textContent = 'Could not load documents.';
                     noDocsMsg.style.display = 'block';
                }

            } catch (error) {
                console.error('Error fetching documents:', error);
                noDocsMsg.textContent = 'Error connecting to server.';
                noDocsMsg.style.display = 'block';
            }
        });
    </script>
</body>
</html>
